### Preliminaries

比特币是一种分布式、去中心化的加密货币。比特币的用户被称为客户端，每个客户端都可以拥有账户，这些账户被称为地址。一个客户端可以通过创建交易并将其提交到称为区块链的全局仅附加日志中，向另一个客户端发送比特币。区块链由一组矿工维护，他们因自己的努力而获得比特币作为报酬。比特币交易受到加密技术的保护，确保只有比特币地址的合法所有者才能从中转移资金。

矿工负责将交易记录在区块链中，这决定了比特币的所有权。如果在一个时间点t之前区块链的前缀中，涉及该客户端地址的交易总额达到x，那么该客户端在时间t拥有x个比特币。矿工只接受输入未被花费的交易。

#### 2.1 Bitcoin and Mining

区块链以区块为单位记录交易。每个区块包含一个唯一标识符，以及前一个区块的标识符。第一个区块，被称为创世区块，是作为协议的一部分定义的。一个有效的区块包含一个加密难题的解决方案，该难题涉及前一个区块的哈希值、当前区块中交易的哈希值，以及一个将因解决加密难题而获得奖励的比特币地址。这个过程被称为比特币挖矿，并且，通过轻微的术语滥用，我们将区块的创建称为区块挖矿。具体的加密难题是一个双重哈希，其结果必须小于一个设定值。问题的难度，由这个值设定，是动态调整的，以确保区块以平均每十分钟一个的速度生成。

任何矿工都可以通过简单地在覆盖网络上发布它来将一个有效的区块添加到链中。如果两个矿工创建了两个具有相同前一个区块的区块，链就会分叉成两个分支，形成一棵树。其他矿工随后可以在任一分支上添加新的有效区块。当一个矿工试图在一个现有区块之后添加一个新块时，我们说它在现有区块上挖矿。这个现有区块可能是分支的头部，在这种情况下，我们说矿工在分支的头部挖矿，或者简单地说在分支上挖矿。

分支的形成是不理想的，因为矿工必须维护一个全球一致的完全有序的交易集合。为了解决分叉，协议规定矿工应该采用并挖矿在最长链上。所有矿工都会在他们所知道的最长链上添加区块，或者如果存在长度相等的分支，则在第一个听到的链上添加。这导致分叉的分支被修剪；修剪区块中的交易被忽略，并且可以由客户端重新提交。

我们注意到，区块在覆盖网络上的传播需要几秒钟，而平均挖矿间隔是10分钟。因此，意外的分叉是罕见的，平均大约每60个区块发生一次。当一个矿工创建一个区块时，它会因其努力而获得比特币补偿。这种补偿包括由包含其交易的用户的每笔交易费用，以及之前不存在的新的比特币数量。

#### 2.2 Pool formation

挖矿一个区块的概率与用于解决相关加密难题的计算资源成正比。由于挖矿过程的性质，从单个矿工的角度来看，挖矿事件之间的间隔表现出高方差。一个使用自制硬件的单个家庭矿工可能多年都无法挖到一个区块。因此，矿工们通常会组织成矿池。矿池中的所有成员一起合作挖取每个区块，并在其中一名成员成功挖到区块时共享收益。虽然加入矿池不会改变矿工的预期收入，但它减少了方差，并使得每月的收入更加可预测。

### The Selfish Mining Strategy

首先，我们建立了一个模型，该模型捕捉了比特币挖矿行为的基本要素，并引入了相关系统参数的符号表示。然后我们详细描述了自私挖矿算法。

#### 3.1. 建模矿工和矿池

系统由一组矿工1, ..., n组成。每个矿工i拥有挖矿能力mi，使得每个矿工选择一个链头进行挖矿，并在一个时间间隔后找到该链头的后续区块，该时间间隔服从均值为的指数分布。我们假设矿工是理性的；也就是说，他们试图最大化自己的收入，并且可能会偏离协议以实现这一目标。

一组矿工可以组成一个矿池，该矿池作为一个具有集中协调者的单一代理，遵循某种策略。矿池的挖矿能力是其成员挖矿能力的总和，其收入根据其成员的相对挖矿能力在他们之间分配。矿池的预期相对收入，或简称为收入，是该矿池挖出的区块在最长链中总区块数中所占的预期比例。

#### 3.2. 自私挖矿

我们现在描述我们的策略，称为自私挖矿。正如我们在第4节中所示，自私挖矿允许一个足够大的矿池获得超过其挖矿能力比例的收入。为了简化，并且不失一般性，我们假设矿工分为两组，一组是遵循自私挖矿策略的合谋少数矿池，另一组是遵循诚实挖矿策略（其他人）的多数。诚实矿工是否作为一个单一群体、一组群体或个体运作并不重要。

自私挖矿策略背后的关键见解是迫使诚实矿工在陈旧的公共分支上进行浪费的计算。具体来说，自私挖矿迫使诚实矿工在其周期内花费在注定不会成为区块链一部分的区块上。

自私矿工通过有选择地揭示他们挖出的区块来使诚实矿工的工作无效，从而实现这一目标。大致来说，自私挖矿矿池将其挖出的区块保密，秘密地使区块链分叉并创建一个私有分支。与此同时，诚实矿工继续在较短的公共分支上挖矿。由于自私矿工控制了相对较小部分的总挖矿能力，他们的私有分支不会无限期地领先于公共分支。因此，自私挖矿策略谨慎地从私有分支向公众揭示区块，以便诚实矿工会切换到最近揭示的区块，放弃较短的公共分支。这使得他们在较短的公共分支上之前所花费的努力变得浪费，并使自私矿池能够通过将更高比例的其区块纳入区块链来收集更高的收入。

有了这个直觉，我们可以完全指定自私挖矿策略。该策略由自私矿池或其他矿工的挖矿事件驱动。其决策仅取决于自私矿池的私有分支与公共分支的相对长度。最好通过涉及不同公共和私有链长度的可能场景来阐述自私挖矿策略的操作。

当公共分支比私有分支长时，自私挖矿矿池落后于公共分支。由于自私矿工与其他矿工之间的能力差异，自私矿工在自己的私有分支上挖矿并超越主分支的可能性很小。因此，每当其私有分支落后时，自私矿工矿池就简单地采用主分支。当其他矿工发现并发布新块时，矿池更新并在当前公共头部挖矿。

当自私矿工矿池发现一个区块时，它处于一个有利的位置，在诚实矿工操作的公共分支上领先一个区块。自私矿工不是简单地发布这个私有区块并通知其他矿工新发现的区块，而是将这个区块保留在矿池内。此时有两种可能的结果：要么诚实矿工在公共分支上发现一个新的区块，使矿池的领先无效，要么矿池挖出第二个区块并扩大其对诚实矿工的领先。

在第一种情况下，诚实节点在公共分支上成功找到一个区块，使自私矿池的领先无效，矿池立即发布其私有分支（长度为1）。这导致了一个平局，其中任一分支都可能获胜。自私矿工一致采用并扩展之前私有的分支，而诚实矿工将根据通知的传播情况选择在任一分支上挖矿。如果自私矿池设法在未采用矿池最近揭示区块的诚实矿工之前挖出后续区块，它会立即发布以享受其分支上第一个和第二个区块的收入。如果诚实矿工在矿池揭示的区块之后挖出区块，矿池享受其区块的收入，而其他矿工从他们的区块中获得收入。最后，如果诚实矿工在自己的区块之后挖出区块，他们享受其两个区块的收入，而矿池则一无所获。

在第二种情况下，自私矿池成功找到第二个区块，它建立了一个舒适的两个区块的领先优势，为诚实矿工的发现提供了一些缓冲。一旦矿池达到这一点，它继续在其私有分支的头部挖矿。它为其他矿工发现的每个区块从其私有分支发布一个区块。由于自私矿池是少数，其领先优势最终很可能会减少到一个区块。此时，矿池发布其私有分支。由于私有分支比公共分支长一个区块，它被所有矿工采纳为主分支，矿池享受其所有区块的收入。这使系统回到只有一个分支的状态，直到矿池再次使其分叉。

### Analysis

我们现在可以分析一个系统中自私矿池拥有挖矿能力α，而其他矿工拥有(1 − α)的预期奖励。

图1以状态机的形式展示了系统的进展。系统的状态代表了自私矿池的领先优势；即，矿池私有分支中未发布的区块数量与公共分支长度的差值。零领先被分为状态0和状态0’。状态0是没有分支的状态；即，只有一条单一的、全球的、公共的最长链。状态0’是存在两条长度为一的公共分支的状态：主分支和自私矿工私有并发布以匹配主分支的分支。图中的转换对应于挖矿事件，无论是由自私矿池还是其他矿工引起的。回想一下，这些事件以平均频率α和(1 − α)分别在指数间隔上发生。

我们可以通过考虑状态机的每个状态转换的频率，并计算相应的奖励来分析自私挖矿的预期奖励。让我们逐一分析各种情况和触发状态转换的相关事件。

如果矿池有一个长度为1的私有分支，而其他矿工挖出一个区块，矿池立即发布其分支，导致两条长度为一的公共分支。自私矿池中的矿工都在矿池的分支上挖矿，因为在这个分支上发现后续区块将为矿池带来奖励。遵循标准比特币协议实现的诚实矿工在首先听到的分支上挖矿。我们用γ表示选择在矿池区块上挖矿的诚实矿工的比例，而其他(1−γ)的非矿池矿工在另一分支上挖矿。

对于状态s = 0, 1, 2, . . .，以频率α，矿池挖出一个区块，领先优势增加到s + 1。在状态s = 3, 4, . . .，以频率(1 − α)，诚实矿工挖出一个区块，领先优势减少到s − 1。如果其他矿工在领先优势为二时挖出一个区块，矿池发布其私有分支，系统下降到领先优势为0。如果其他矿工在领先优势为一时挖出一个区块，我们到达上述状态0’。从0’开始，有三个可能的转换，所有转换都以总频率1导致状态0：(1)矿池在其之前私有的分支上挖出一个区块（频率α），(2)其他矿工在之前私有的分支上挖出一个区块（频率γ(1 − α)），(3)其他矿工在公共分支上挖出一个区块（频率(1 − γ)(1 − α)）。

#### 4.1 Revenue

我们分析状态机并计算状态的概率p0′, p0, p1, ...；详细信息在我们的完整报告中。9 状态空间上的概率分布为分析自私矿池和诚实矿工获得的收入提供了基础。发现区块的收入仅属于其矿工，如果该区块最终成为主链的一部分。我们在下面详细说明每个事件的收入。

(a) 除长度为1的两条分支外的任何状态，矿池发现一个区块。矿池将其私有分支延长一个区块，使其在公共分支上的领先优势增加一个。该区块的收入将在稍后确定。

(b) 之前是长度为1的两条分支，矿池发现一个区块。矿池发布其长度为二的秘密分支，从而获得两笔收入。

(c) 之前是长度为1的两条分支，其他矿工在矿池头部之后发现一个区块。矿池和其他矿工各获得一笔收入——其他矿工为新区块，矿池为其前驱区块。

(d) 之前是长度为1的两条分支，其他矿工在其头部之后发现一个区块。其他矿工获得两笔收入。

(e) 没有私有分支，其他矿工发现一个区块。其他矿工获得一笔收入，矿池和其他矿工都在新区块上开始挖矿。

(f) 领先优势为1，其他矿工发现一个区块。现在有两条长度为一的分支，矿池发布其单一的秘密区块。矿池试图在其之前私有的头部上挖矿，其他矿工在两条头部之间分配。

(g) 领先优势为2，其他矿工发现一个区块。其他矿工几乎缩小了差距，领先优势降至1。矿池发布其秘密区块，导致所有人开始在其之前私有的分支头部上挖矿，因为它更长。矿池获得两笔收入。

(h) 领先优势超过2，其他矿工发现一个区块。其他矿工减少了领先优势，但领先优势至少保持为2。新块（假设编号为i）一旦矿池发布其整个分支，将位于链外，因此其他矿工一无所获。然而，矿池现在揭示其第i个区块，并为其第i个区块获得一笔收入。

$$
r_{\mathrm{honest}}=p_{0'}\cdot \gamma \left( 1-\alpha \right) \cdot 1+p_{0'}\cdot \left( 1-\gamma \right) \left( 1-\alpha \right) \cdot 2+p_0\cdot \left( 1-\alpha \right) \cdot 1
\\
r_{\mathrm{selfish}}=p_{0'}\cdot \alpha \cdot 2+p_{0'}\cdot \gamma \left( 1-\alpha \right) \cdot 1+p_2\cdot \left( 1-\alpha \right) \cdot 2+p\left[ i>2 \right] \left( 1-\alpha \right) \cdot 1
$$
如预期那样，自私挖矿带来的有意分叉导致诚实矿工在最终位于区块链之外的区块上工作。这反过来导致总区块生成率下降，即rpool + rothers < 1。协议将调整挖矿难度，使得主链上的挖矿速率平均为每10分钟一个区块。因此，每个代理的实际收入率是其收入率比率；即，其区块在主链区块中所占的比例。我们用参考文献9中的概率替换（1）-（2）中的收入表达式，以计算0<α时矿池的收入。





当方程3给出的矿池收入大于α时，矿池将通过使用Selfish-Mine策略获得超过其相对规模的收入。因此，其矿工将获得超过其相对挖矿能力的收入。回想一下，该表达式仅在0<α<1/3时有效。我们解这个不等式，并将结果表述为以下观察：

观察1. 对于给定的γ，大小为α的矿池获得的收入大于其相对规模，其范围为α。

我们在图2中对此进行了说明，我们看到矿池的收入对于不同的γ值，矿池大小从0（非常小的矿池）到0.5（一半的矿工）。请注意，只有当矿池恰好持有一个秘密区块时，矿池才处于风险之中，诚实矿工可能会发布一个与之竞争的区块。对于γ=1，如果其他矿工发现自己的分支，矿池可以迅速传播其一个区块的分支，因此所有诚实矿工仍将在矿池的区块上挖矿。在这种情况下，矿池在遵循Selfish-Mine策略时不会承担任何风险，其收入总是优于遵循诚实算法时的收入。因此，阈值为零，任何规模的矿池都可以通过遵循Selfish-Mine获益。在另一个极端，γ=0，诚实矿工总是首先发布和传播他们的区块，阈值为1/3。对于γ=1/2，阈值为1/4。图3显示了阈值作为γ的函数。

我们还注意到，矿池收入Rpool作为矿池大小的函数的斜率在阈值以上大于1。这意味着以下观察：

观察2. 对于运行Selfish-Mine策略的矿池，每个矿池成员的收入随着矿池大小超过阈值而增加。